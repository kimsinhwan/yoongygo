<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Location</title>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoieW9vbmd5OTEiLCJhIjoiY21jMDczMzV1MXg0YTJqbjFiazMzdWI0ciJ9.1553HcxLbM-BN_v6t5d3zg';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [126.978, 37.5665], // 초기 좌표 (서울)
    zoom: 15
  });

  const marker = new mapboxgl.Marker()
    .setLngLat([126.978, 37.5665])
    .addTo(map);

  // 위치 권한 요청 및 위치 업데이트 시작 함수
  function startLocationTracking() {
    if (navigator.geolocation) {
      // 위치 권한 요청 (권한 팝업이 뜸)
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          // 권한 허용되면 위치 감시 시작
          watchPosition();
        },
        (err) => {
          alert('위치 권한이 필요합니다.');
        },
        { enableHighAccuracy: true }
      );
    } else {
      alert('이 브라우저는 위치 정보를 지원하지 않습니다.');
    }
  }

  function watchPosition() {
    navigator.geolocation.watchPosition(pos => {
      const lng = pos.coords.longitude;
      const lat = pos.coords.latitude;
      marker.setLngLat([lng, lat]);
      map.setCenter([lng, lat]);
    }, err => {
      alert('위치 정보를 가져오는데 실패했습니다.');
    }, {
      enableHighAccuracy: true
    });
  }

  // 위치 권한 요청 시작
  startLocationTracking();
</script>
</body>
</html>