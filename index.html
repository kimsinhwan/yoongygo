<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Location</title>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
    /* 설정 버튼 스타일 */
    #settingsBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      padding: 10px 15px;
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- 화면 이동 버튼 -->
  <button id="settingsBtn">맵 이동</button>
  <div id="map"></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoieW9vbmd5OTEiLCJhIjoiY21jMDczMzV1MXg0YTJqbjFiazMzdWI0ciJ9.1553HcxLbM-BN_v6t5d3zg';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [126.978, 37.5665], // 초기 좌표 (서울)
      zoom: 15
    });

    const marker = new mapboxgl.Marker()
      .setLngLat([126.978, 37.5665])
      .addTo(map);

    // 위치 권한 요청 강제 호출
    function requestLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lng = pos.coords.longitude;
            const lat = pos.coords.latitude;
            marker.setLngLat([lng, lat]);
            map.setCenter([lng, lat]);
          },
          (err) => {
            alert('위치 권한이 필요합니다. 브라우저 설정에서 위치 권한을 허용해주세요.');
          },
          { enableHighAccuracy: true }
        );
      } else {
        alert('이 브라우저는 위치 정보를 지원하지 않습니다.');
      }
    }

    // 페이지 로드 시 위치 권한 요청 강제 실행
    window.onload = () => {
      requestLocation();

      // 이후 위치 감시 시작
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          (pos) => {
            const lng = pos.coords.longitude;
            const lat = pos.coords.latitude;
            marker.setLngLat([lng, lat]);
            map.setCenter([lng, lat]);
          },
          (err) => {
            console.error('위치 업데이트 실패:', err);
          },
          { enableHighAccuracy: true }
        );
      }
    };

    // 버튼 클릭 시 맵 이동
    document.getElementById('settingsBtn').addEventListener('click', () => {
      // 원하는 위치로 이동 (예: 강남역)
      const targetLng = 127.0276;
      const targetLat = 37.4979;
      map.flyTo({ center: [targetLng, targetLat], zoom: 15 });
    });
  </script>
</body>
</html>